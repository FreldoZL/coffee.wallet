<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Coffee Wallet, crypto currencies wallet and portfolio">
    <meta name="author" content="Franciszek Szczepan Wawrzak">
    <title>Recover Private Keys | Coffee Wallet</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png"/>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <script type="text/javascript" src="vendor/qrcode.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Catamaran" rel="stylesheet">
    <style type="text/css">
      html, body {
        margin: 0;
        padding: 0;
      }
      body {
        background: #62422b;
        background: -webkit-linear-gradient(to bottom right,#62422b,#2b0f0e);
        background: linear-gradient(to bottom right,#62422b,#2b0f0e);
        background-position: center;
        min-height: 100vh;
        color: #eadfcb;
        font-family: Catamaran,Helvetica,Arial,sans-serif;
      }
      .hidden {
        display: none;
      }
      .content {
        max-width: 740px;
        margin: 0 auto;
        text-align: center;
      }
      h1 {
        margin: 0;
        padding: 20px 0 10px 0;
      }
      h2 {
        text-align: left;
        font-size: 20px;
      }
      #ticket {
        padding: 20px;
        background: #eadfcb;
        color: #62422b;
        margin: 25px 0;
        border-radius: 30px;
      }
      a {
        color: #42221b;
      }
      .button {
        color: #42221b;
        border: 1px solid #42221b;
        border-radius: 300px;
        padding: 15px 20px;
        text-decoration: none;
        display: block;
        margin: 20px 10px;
        background: none;
        cursor: pointer;
      }
      #notes {
        text-align: left;
      }
      footer {
        margin-top: 50px;
        text-align: center;
        color: #777;
      }
      footer a {
        color: #777;
        text-decoration: none;
      }
      .niceTable {
        width: 100%;
      }
      .niceTable td {
        word-break: break-word;
        text-align: left;
      }
      .error {
        color: red;
      }
      #mnemonic {
        border: 1px solid #42221b;
        box-sizing: border-box;
        width: 100%;
        padding: 10px 15px;
        font-size: 22px;
      }
      button.button {
       margin: 20px auto;
       min-width: 20%;
      }
    </style>
  </head>
  <body>
    <div id="success" class="content">
      <h1>Recover Privete Keys</h1>
      <p>
        This tool generates private keys using BIP39 standard.
        <br/>
        Enter your 12-word mnemonic phrase generated by Coffee Wallet below:
      </p>
      <ul>
      </ul>

      <div id="ticket">
        <label for="mnemonic">backup phrase (12 words, space separated):</label>
        <input id="mnemonic" type="text"/>
        <button class="button" onclick="generatePrivateKeys()">Generate</button>
        <div id="validation"></div>
        <table class="niceTable">
          <tbody id="privateKeys"></tbody>
        </table>
        <p>
        </p>
      </div>

      <p>
        notes:
      </p>
      <div id="notes">
        <ul>
          <li>This tool works offline, so you can disconnect from the Internet (after the page loads) for extra security.</li>
          <li>You can try to use your BIP39 phrase in other software that supports it. However, this standard is not 100% clear on how to generate keys for coins other than BTC. This tool uses the same codebase as Coffee Wallet and generates exactly same keys.</li>
        </ul>
      </div>
    </div>
    <footer>
      <div class="content">
        <a href="http://wallet.coffee/">Coffee Wallet</a> &copy; 2018 <a href="http://software.coffee/">Coffee Software Ltd</a>

      </div>
    </footer>
    <script type="text/javascript" src="appwww/vendor/web3.js"></script>
    <script type="text/javascript" src="appwww/vendor/btcjs.js"></script>
    <script type="text/javascript" src="appwww/js/coin.apis.btcjs.js"></script>
    <script type="text/javascript" src="appwww/js/coin.apis.web3js.js"></script>
    <script type="text/javascript">

      var allCoinApis = {
        'BTC': BtcHandler,
        'ETH': EthHandler,
        'LTC': LtcHandler,
        'DOGE': DogeHandler,
        //'CFT': ERC20Tokens.CFT,
        //'PAY': ERC20Tokens.PAY,
        'BTC.TST': BtcTestHandler,
        'ETH.TST': EthTestHandler,
        'ERC20.TST': ERC20Tokens['ERC20.TST']
      };

      function generatePrivateKeys() {

        var mnemonic = document.getElementById('mnemonic').value;
        document.getElementById('validation').innerHTML = '';
        if (!btcjs.validateMnemonic(mnemonic)) {
          document.getElementById('validation').innerHTML = '<span class="error">WARNING: This phrase seems to be invalid. Generated keys might not be correct!</span>';
        }
        app = {
          data: {
            wallets: {
              bip39: {
                enabled : false,
                mnemonic: mnemonic,
                seedHex: btcjs.mnemonicToSeedHex(mnemonic)
              }
            }
          }
        };
        config = {
          infuraKey : ''
        };
        document.getElementById('privateKeys').innerHTML = '';
        for (key in allCoinApis){
          var privateKey;
          if (typeof allCoinApis[key].newPrivateKey == 'function') {
            privateKey = allCoinApis[key].newPrivateKey();
          } else {
            privateKey = allCoinApis[key].newPrivateKey.newPrivateKey()
          }
          var publicKey = allCoinApis[key].addrFromPrivateKey(privateKey);
          var explorerLink = '';
          if ('explorerLinkAddr' in allCoinApis[key]) {
            explorerLink = '<a target="_blank" href="' + allCoinApis[key].explorerLinkAddr(publicKey) + '">(explorer)</a>';
          }

          document.getElementById('privateKeys').insertAdjacentHTML(
            'beforeend',
            '<tr><th rowspan="2">' + key + '</th><td>address:</td><td><strong>' + publicKey + ' ' + explorerLink + '</strong></td></tr><tr><td>private key:</td><td><strong>' + privateKey + '</strong></td></tr>'
          );
        }

      }


    </script>
  </body>
</html>
